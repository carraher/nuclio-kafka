metadata:
  name: rest-ingest
spec:
  description: "Showcases unstructured logging and a structured response."
  handler: "main:handler"
  runtime: "python:3.6"
  resources: {}
  image: "nuclio/processor-rest-ingest:latest"
  minReplicas: 1
  maxReplicas: 1
  build:
    registry: "127.0.0.1:31500"
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCB0aW1lCmZyb20ga2Fma2EgaW1wb3J0IEthZmthUHJvZHVjZXIKCiMgZGVmIGluaXRfY29udGV4dChjb250ZXh0KToKZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOgogICAgY29udGV4dC5sb2dnZXIuaW5mbygncmVzdC1pbmdlc3QuaGFuZGxlciBiZWdpbicpCiAgICB0cnk6CiAgICAgICAgcHJvZHVjZXIgPSBLYWZrYVByb2R1Y2VyKGJvb3RzdHJhcF9zZXJ2ZXJzPW9zLmdldGVudignS0FGS0EnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVfc2VyaWFsaXplcj1sYW1iZGEgeDoganNvbi5kdW1wcyh4KS5lbmNvZGUoJ3V0Zi04JyksYXBpX3ZlcnNpb249KDIsIDIsIDApKQoKICAgICAgICB0aW1lLnNsZWVwKGludChvcy5nZXRlbnYoJ1NMRUVQJywgMSkpKQogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ3Jlc3QtaW5nZXN0LmhhbmRsZXIgc2VuZGluZzogJyArIHN0cihldmVudC5ib2R5KSkKCiAgICAgICAgcHJvZHVjZXIuc2VuZChvcy5nZXRlbnYoJ0tBRktBX1RPUElDX09VVCcpLCB2YWx1ZT1ldmVudC5ib2R5KQogICAgICAgIHByb2R1Y2VyLmZsdXNoKCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcigncmVzdC1pbmdlc3QuaGFuZGxlciBFeGNlcHRpb246ICcgKyBzdHIoZSkpCiAgICAgICAgcmFpc2UKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdyZXN0LWluZ2VzdC5oYW5kbGVyIGVuZCcpCgogICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nSW5nZXN0IHNlbnQgbWVzc2FnZSB0byBudWNsaW9ldmVudHMgdG9waWMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfY29kZT0yMDApCg==
    codeEntryType: sourceCode
    commands:
      - 'pip install kafka-python==2.0.2'
  platform: {}
  env:
  - name: KAFKA
    value: "kafka-hub-0.kafka-hub-headless.nuclio.svc.cluster.local:9092"
  - name: KAFKA_TOPIC_OUT
    value: "ingest"
  readinessTimeoutSeconds: 60